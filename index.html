<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz de calcul mental (V=8nd)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      text-align: center;
      padding: 20px;
    }
    h1 { color: #333; }
    .question { font-size: 1.3em; margin: 20px 0; }
    .type-label { font-weight: bold; margin-bottom: 10px; font-size: 1.2em; }
    input[type="number"] { padding: 12px; font-size: 1.3em; width: 180px; text-align: center; margin-bottom: 12px; }
    button { padding: 12px 20px; font-size: 1.3em; margin: 10px; cursor: pointer; }
    .result { font-weight: bold; margin-top: 15px; font-size: 1.2em; }
    .correction { margin-top: 15px; text-align: left; display: inline-block; background: #fff; border: 1px solid #ddd; padding: 12px; max-width: 600px; line-height: 1.4; }
    .small { font-size: 0.95em; color: #555; }
    @media (max-width: 600px) {
      .question { font-size: 1.5em; }
      input[type="number"], button { width: 90%; font-size: 1.4em; }
    }
  </style>
</head>
<body>
  <h1>Quiz de calcul mental (V=8nd)</h1>
  <div class="type-label" id="type-label"></div>
  <div class="question" id="question"></div>
  <input type="number" id="answer" placeholder="Votre réponse"><br>
  <button onclick="checkAnswer()">Vérifier</button>
  <button onclick="newQuestion()">Nouvelle question</button>
  <button onclick="showCorrection()">Afficher correction</button>
  <div class="result" id="result"></div>
  <div id="correction" class="correction" style="display:none;"></div>

  <script>
    const FACTOR = 1.77 * 8;
    let current = { type: null, params: {}, rawAnswer: 0, roundedAnswer: 0 };

    function degToRad(deg){ return deg * Math.PI / 180; }
    function randomGIS(){ let v; do { v=Math.floor(Math.random()*360); } while(v===1); return v; }
    function randomW(){ const p=[-3,-2,-1,1,2,3]; return p[Math.floor(Math.random()*p.length)]; }
    function randomDistance(){ const min=1000,max=15000,count=Math.floor((max-min)/500)+1; return min+500*Math.floor(Math.random()*count); }
    function randomGisement180(){ return 5*Math.floor(Math.random()*37); }
    function roundTo500(val){ return Math.round(val/500)*500; }

    function newQuestion(){
      document.getElementById("result").textContent = "";
      document.getElementById("correction").style.display = "none";
      document.getElementById("correction").innerHTML = "";
      document.getElementById("answer").value = "";
      document.getElementById("type-label").textContent = "";

      let valid=false, type, params, raw, rounded;
      while(!valid){
        type = Math.random()<0.33 ? 3 : (Math.random()<0.5 ? 1 : 2);
        if(type===1){
          const g1=randomGIS(), g2=randomGIS();
          let w1=randomW(), w2; do{ w2=randomW(); } while(w2===w1);
          const sin1=Math.sin(degToRad(g1)), sin2=Math.sin(degToRad(g2));
          const numerator = FACTOR*(sin2-sin1);
          const denominator = w2-w1;
          raw = numerator/denominator;
          rounded = Math.round(raw);
          if(rounded>=1 && rounded<=30) valid=true;
          params={g1,g2,w1,w2};
        } else if(type===2){
          const g=randomGIS(), w=randomW();
          const sinG=Math.sin(degToRad(g));
          raw = FACTOR*sinG/w;
          rounded = Math.round(raw);
          if(rounded>=1 && rounded<=30) valid=true;
          params={g,w};
        } else{
          const d=randomDistance(), gis=randomGisement180();
          raw = d*Math.sin(degToRad(gis));
          rounded = roundTo500(raw);
          valid=true;
          params={d,gis};
        }
      }

      current = {type, params, rawAnswer: raw, roundedAnswer: rounded};
      const typeLabel = document.getElementById("type-label");
      const questionDiv = document.getElementById("question");

      if(type===1){
        typeLabel.textContent = "Ekelund (arrondi à 1 km)";
        const {g1,g2,w1,w2}=params;
        questionDiv.textContent = `g1=${g1}, g2=${g2}, w1=${w1}, w2=${w2}`;
      } else if(type===2){
        typeLabel.textContent = "Croisement (arrondi à 1 km)";
        const {g,w}=params;
        questionDiv.textContent = `g=${g}, w=${w}`;
      } else{
        typeLabel.textContent = "Distance à la route (arrondi à 500 m)";
        const {d,gis}=params;
        questionDiv.textContent = `d=${d}, gis=${gis}`;
      }
    }

    function checkAnswer(){
      const ansField=document.getElementById("answer").value;
      const resultDiv=document.getElementById("result");
      if(ansField===""){ resultDiv.textContent="Veuillez entrer une valeur."; resultDiv.style.color="red"; return; }
      const userAnswer=parseInt(ansField,10);
      if(isNaN(userAnswer)){ resultDiv.textContent="Valeur invalide."; resultDiv.style.color="red"; return; }

      const correct=current.roundedAnswer;
      let isCorrect=false;
      if(current.type===3){ isCorrect = (userAnswer===correct); }
      else { isCorrect = (Math.abs(userAnswer-correct)<=1); }

      resultDiv.style.color = isCorrect?"green":"red";
      resultDiv.textContent = isCorrect? `✅ Correct !` : `❌ Faux.`;
    }

    function showCorrection(){
      const cDiv=document.getElementById("correction");
      cDiv.style.display="block"; 
      cDiv.innerHTML="";
      if(!current.type){ cDiv.innerHTML="<div class='small'>Aucune question générée.</div>"; return; }

      if(current.type===1){
        const {g1,g2,w1,w2}=current.params;
        const sin1=Math.sin(degToRad(g1)), sin2=Math.sin(degToRad(g2));
        const numerator = FACTOR*(sin2-sin1);
        const denominator = w2-w1;
        cDiv.innerHTML=`g1=${g1}, g2=${g2}, w1=${w1}, w2=${w2}<br>
        Numérateur=${numerator.toFixed(6)}, Dénominateur=${denominator}<br>
        Résultat exact=${current.rawAnswer.toFixed(6)}, arrondi=${current.roundedAnswer}`;
      } else if(current.type===2){
        const {g,w}=current.params;
        const sinG=Math.sin(degToRad(g));
        cDiv.innerHTML=`g=${g}, w=${w}<br>
        sin(${g})=${sinG.toFixed(6)}<br>
        Résultat exact=${current.rawAnswer.toFixed(6)}, arrondi=${current.roundedAnswer}`;
      } else{
        const {d,gis}=current.params;
        const sinG=Math.sin(degToRad(gis));
        cDiv.innerHTML=`d=${d}, gis=${gis}<br>
        sin(${gis})=${sinG.toFixed(6)}<br>
        Résultat exact=${current.rawAnswer.toFixed(6)}, arrondi à 500 m=${current.roundedAnswer}`;
      }
    }

    // Générer la première question au chargement
    newQuestion();
  </script>
</body>
</html>


